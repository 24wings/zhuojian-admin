<nz-breadcrumb style="margin:12px 0;">
  <nz-breadcrumb-item routerLink="/admin">分销商系统</nz-breadcrumb-item>
  <nz-breadcrumb-item>分销商管理</nz-breadcrumb-item>
</nz-breadcrumb>

<div style="padding:30px;">
  <div style="background:#fff">
    <nz-card>
      <ng-template #title>
      </ng-template>
      <ng-template #body>
        <button nz-button [nzType]="!selectedFenxaioUser?'primary':'default'" (click)="listMaterials()">
          全部</button>
        <!-- <button nz-button [nzType]="selectedFenxaioUser==fenxiaoUser.value?'primary':'default'" *ngFor="let fenxiaoUser of fenxiaoUsers" (click)="selectedGroupId=group.value;listProducts()"> -->
        <!-- <span>{{group.label}}</span> -->
        <!-- </button> -->
        <hr>
        <button nz-button [nzType]="'primary'" (click)="state=ViewState.Create">+ 新建</button>
        <nz-dropdown>
          <!-- <nz-input [(ngModel)]="keyword" [nzPlaceHolder]="'输入产品组名'" style="max-width:200px;"></nz-input> 选择日期 -->
          <!-- <button nz-button [nzType]="'primary'">查询</button> -->
          <!-- <button nz-button>重置</button> -->
          <!-- 只显示推荐产品:
          <nz-switch [(ngModel)]="showRecommand"></nz-switch> -->
          <a class="ant-dropdown-link" nz-dropdown>
            <button nz-button> 批量操作</button>
            <i class="anticon anticon-down"></i>
          </a>
          <ul nz-menu>
            <li nz-menu-item>
              <a rel="noopener noreferrer" (click)="deleteFenxiaoUser()">删除选中</a>
            </li>
            <!-- <li nz-menu-item> -->
            <!-- <a target="_blank" rel="noopener noreferrer" href="http://www.alipay.com/">2nd menu item</a> -->
            <!-- </li> -->
            <!-- <li nz-menu-item> -->
            <!-- <a target="_blank" rel="noopener noreferrer" href="http://www.alipay.com/">3rd menu item</a> -->
            <!-- </li> -->
          </ul>
        </nz-dropdown>
        <nz-table #nzTable [nzDataSource]="materials" [nzPageSize]="10">
          <thead nz-thead>
            <tr>
              <th nz-th nzCheckbox>
                <label nz-checkbox [(ngModel)]="_allChecked" [nzIndeterminate]="_indeterminate" (ngModelChange)="_checkAll($event)">
                </label>
              </th>
              <th nz-th>
                <span>Id</span>
              </th>
              <th nz-th>首页图片</th>
              <th nz-th>详情页图片</th>
              <th nz-th>
                分享图片/Logo
              </th>
              <th nz-th>是否注册赠送</th>
              <th nz-th>是否分享赠送</th>
              <th nz-th>
                <span>创建时间</span>
              </th>
              <th nz-th>更新时间</th>

              <th nz-th>
                <span>操作</span>
              </th>
            </tr>
          </thead>
          <tbody nz-tbody>
            <tr nz-tbody-tr *ngFor="let data of nzTable.data">
              <td nz-td nzCheckbox>
                <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="_refreshStatus($event)">
                </label>
              </td>
              <td nz-td>{{data.id}}</td>
              <td nz-td>
                <img [src]="data.home_image_url" alt="" style="max-width: 60px;"> </td>
              <td ng-td>
                <img [src]="data.ticket_image_url" alt="" style="max-width: 60px;"> </td>
              <td nz-td>
                <img [src]="data.share_image_url" style="max-width: 60px;">
              </td>
              <td nz-td>{{data.reg_give?"是":"否"}}</td>
              <td nz-td>{{data.can_share?"是":"否"}}</td>

              <td nz-td>{{data.created_at | date:'yyyy-MM-dd HH:mm:ss'}}</td>
              <td nz-td>{{data.updated_at | date:'yyyy-MM-dd HH:mm:ss'}}</td>


              <td nz-td>
                <!-- <a (click)="activeProduct(data._id)"> 上架</a> -->
                <!-- <a (click)="unactiveProduct(data._id)">下架</a> -->
                <a (click)="selectedProduct=data;modifyModalVisible=true">编辑</a>
                <a (click)="selectedFenxaioUser=data;manageParentVisible=true">设置上级</a>
              </td>
            </tr>
          </tbody>
        </nz-table>

      </ng-template>
    </nz-card>
  </div>
</div>

<ng-container *ngIf="state==ViewState.Create">
  <!-- 管理用户上下级 -->
  <nz-modal [nzTitle]="'添加产品'" [nzVisible]="true" [nzContent]="modalContent" (nzOnCancel)="state=ViewState.List;" (nzOnOk)="state=ViewState.List;createMaterial($event)">
    <ng-template #modalContent>

      <div class="field">
        <label class="label"> 产品名字</label>
        <div>
          <figure (click)="addHomeImageUrl()">
            <img src="/assets/images/upload-image.png" alt="">
          </figure>

        </div>
        <div>
          <figure (click)="addHomeImageUrl()">
            <img src="/assets/images/upload-image.png" alt="">
          </figure>

        </div>

        <div>
          <figure (click)="addHomeImageUrl()">
            <img src="/assets/images/upload-image.png" alt="">
          </figure>

        </div>

      </div>




      <div class="field">
        <label nz-checkbox [(ngModel)]="newMaterial.can_share">
          <span>可分享他人注册获取优惠券</span>
        </label>
      </div>
      <div class="field">
        <label nz-checkbox [(ngModel)]="newMaterial.reg_give">
          <span>本人注册获取优惠券</span>
        </label>
      </div>
      <div class="field">
        <label nz-checkbox [(ngModel)]="newMaterial.can_give_other">
          <span>可赠与他人</span>
        </label>
      </div>



    </ng-template>
  </nz-modal>
</ng-container>



<!-- 编辑产品  -->
<ng-container *ngIf="!!selectedMaterial">
  <nz-modal [nzVisible]="modifyModalVisible" [nzTitle]="'添加产品'" [nzContent]="modalContent" (nzOnCancel)="modifyModalVisible=false;"
    (nzOnOk)="modifyModalVisible=false;modifyProduct($event)">
    <ng-template #modalContent>

      <div class="field">
        <label class="label"> 产品名字</label>
        <nz-input [(ngModel)]="selectedProduct.name"></nz-input>
      </div>
      <div class="field">
        <label class="label"> 描述</label>
        <nz-input [(ngModel)]="selectedProduct.summary" [nzType]="'textarea'"></nz-input>
      </div>
      <div class="field">
        <label class="label"> 价格 ￥(.00)</label>
        <nz-input [(ngModel)]="selectedProduct.price" [nzType]="'number'"></nz-input>
      </div>
      <div class="field">
        <label class="label"> 折扣 (%)</label>
        <nz-input nz-col [nzSpan]="12" nzHasFeedback [(ngModel)]="selectedProduct.discount" [nzType]="'number'"></nz-input>
        <!-- <div nz-form-label nz-col [nzSpan]="5"> -->
        <label>%</label>

      </div>

      <div class="field">
        <label class="label"> 计量单位</label>
        <nz-input nz-col [nzSpan]="12" nzHasFeedback [(ngModel)]="selectedProduct.unit"></nz-input>
        <div nz-form-label nz-col [nzSpan]="5">
          <label>%</label>
        </div>
      </div>
      <div class="field">
        <label class="label"> 积分购买限制 0为无需积分,10000为 10000元购买起步</label>
        <nz-input nz-col [nzSpan]="12" nzHasFeedback [(ngModel)]="selectedProduct.minScore" [nzType]="'number'"></nz-input>
      </div>
      <div class="field">
        <label>产品图片组</label>
        <div>
          <figure (click)="modifyProductImages()">
            <img src="/assets/images/upload-image.png" alt="">
          </figure>

          <figure *ngFor="let image of selectedProduct.images" style="max-width:45%;display:inline-block;">
            <img [src]="image" style="max-width:100%;max-height:100%;" alt="">
          </figure>
        </div>
      </div>
    </ng-template>
  </nz-modal>
</ng-container>
